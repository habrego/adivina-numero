<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <title>Adivina el número</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
  </head>

  <body>
    <div id="banner">ADIVINA EL NÚMERO</div>
    <div id="wheel">
      <div id="numbers"></div>
    </div>
    <div id="pointer">&and;</div>
    <div id="message">Intente un número...</div>
    <div id="guess-form">
      <input id="guess-input" name="guess" type="number" min="1" max="100" placeholder="Escoja un número entre 1 y 100">
      <button id="submit-button" type="submit">Intentar</button>
      <button id="restart-button">Reiniciar</button>
    </div>
    Guesses:
    <div id="guesses"></div>
  </body>
<script>
window.onload = () => {
  document.getElementById("submit-button").onclick = guess;
  document.getElementById("guess-input").addEventListener("keyup", function(e) {
    if (e.keyCode === 13) {
      e.preventDefault();
      document.getElementById("submit-button").click();
    }
  });
  document.getElementById("restart-button").onclick = restart;
  window.addEventListener('resize', resizeWindow);
  createNumbers();
  setTargetNumber();
  // just start on some number, doesnt matter
  gotoNumber((Math.round(Math.random() * 80) + 7));
}

var MAX = 100;
var target, lastGuess;

function setTargetNumber() {
  target = Math.floor((Math.random() * MAX) + 1);
}

function restart() {
  document.getElementById("guess-input").value = "";
  resetNumbers();
  setTargetNumber();
  clearGuesses();
  updateMessage("Take a guess...");
}

function resizeWindow() {
  if (lastGuess) {
    gotoNumber(lastGuess);
  }
}

function gotoNumber(n) {
  let nWidth = 70;
  let w = window.innerWidth;
  let offsetNumber1 = (w / 2) - (nWidth / 2);
  let offset = offsetNumber1 - ((n - 1) * nWidth);
  document.getElementById('numbers').style.left = offset + 'px';
}

function createNumbers() {
  for(let i = 1; i <= MAX; i++) {
    document.getElementById("numbers").innerHTML+=
      '<div class="number light" id="n' + i + '">' + i + '</div>';
  }
}

function updateMessage(msg) {
  document.getElementById("message").innerHTML = msg;
}

function addGuessToHistory(guess) {
  let lohi = "";
  if (guess < target) {
    lohi = "&darr;"
  } else if (guess > target) {
    lohi = "&uarr;"
  }
  document.getElementById("guesses").innerHTML += "<div>" + guess + lohi + "</div>";
}

function clearGuesses() {
  document.getElementById("guesses").innerHTML="";
}

function guess() {
  let guess = Math.min(100, Number(document.getElementById("guess-input").value));
  guess = Math.max(1, guess);
  lastGuess = guess;
  addGuessToHistory(guess);
  gotoNumber(guess);
  // resetNumbers();
  if (guess < target) {
    dimLow = 1;
    dimHigh = Math.max(guess, 1);
    updateMessage("too low");
  } else if (guess > target) {
    dimLow = Math.min(guess, MAX);
    dimHigh = MAX;
    updateMessage("too high");
  } else {
    dimNumbers(1, MAX);
    document.getElementById("n" + guess).className = 'number correct';
    updateMessage("You got it!!");
    return;
  }
  dimNumbers(dimLow, dimHigh);
}

function dimNumbers(low, high) {
  for(let i = low; i <= high; i++) {
    document.getElementById("n" + i).className = 'number dark';
  }
}

function resetNumbers() {
  for(let i = 1; i <= MAX; i++) {
    document.getElementById("n" + i).className = 'number light';
  }
}  
</script>
</html>
